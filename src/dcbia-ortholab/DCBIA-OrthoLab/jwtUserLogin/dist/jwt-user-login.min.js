"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="checklist-model"),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(a,b){function c(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b))return!0;return!1}function d(a,b,d){return a=angular.isArray(a)?a:[],c(a,b,d)||a.push(b),a}function e(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b)){a.splice(d,1);break}return a}function f(f,g,h){function i(){t(),u(),v()}function j(){return h.checklistValue?a(h.checklistValue)(f.$parent):h.value}function k(a,b){var c=n(f.$parent);angular.isFunction(n.assign)&&(!0===b?n.assign(f.$parent,d(c,a,r)):n.assign(f.$parent,e(c,a,r)))}function l(a,b){if(p&&!1===p(f))return void k(j(),q(f));q.assign(f,c(a,j(),r))}var m=h.checklistModel;h.$set("checklistModel",null),b(g)(f),h.$set("checklistModel",m);var n=a(m),o=a(h.checklistChange),p=a(h.checklistBeforeChange),q=a(h.ngModel),r=angular.equals;if(h.hasOwnProperty("checklistComparator"))if("."==h.checklistComparator[0]){var s=h.checklistComparator.substring(1);r=function(a,b){return a[s]===b[s]}}else r=a(h.checklistComparator)(f.$parent);var t=f.$watch(h.ngModel,function(a,b){if(a!==b){if(p&&!1===p(f))return void q.assign(f,c(n(f.$parent),j(),r));k(j(),a),o&&o(f)}}),u=f.$watch(j,function(a,b){if(a!=b&&angular.isDefined(b)&&!0===f[h.ngModel]){var c=n(f.$parent);n.assign(f.$parent,e(c,b,r)),n.assign(f.$parent,d(c,a,r))}},!0),v=f.$on("$destroy",i);angular.isFunction(f.$parent.$watchCollection)?f.$parent.$watchCollection(m,l):f.$parent.$watch(m,l,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(a,b){if(!b.checklistValue&&!b.value)throw"You should provide `value` or `checklist-value`.";return b.ngModel||b.$set("ngModel","checked"),f}}}]),angular.module("jwt-user-login",["checklist-model"]),angular.module("jwt-user-login").config(["$httpProvider","$provide",function(a,b){b.factory("jwtInterceptor",["$q","$location",function(a,b){return{request:function(a){var b=localStorage.getItem("clusterpost_token");return b&&(a.headers.authorization="Bearer "+b),a},requestError:function(b){return a.reject(b)},response:function(a){return a},responseError:function(c){return 401!==c.status||localStorage.getItem("clusterpost_token")||"/login"===b.path()||b.path("/"),404===c.status&&console.error(c),a.reject(c)}}}]),a.interceptors.push("jwtInterceptor")}]).factory("clusterauth",["$q","$http","$location","$rootScope",function(a,b,c,d){return{createUser:function(a){return b({method:"POST",url:"/auth/user",data:a}).then(function(a){localStorage.setItem("clusterpost_token",a.data.token)})},getUsers:function(){return b({method:"GET",url:"/auth/users"})},getUser:function(){return d.user?Promise.resolve(d.user):b({method:"GET",url:"/auth/user"}).then(function(a){return d.user=a.data,a.data})},deleteSelf:function(){return b({method:"DELETE",url:"/auth/user"})},login:function(a){return b({method:"POST",url:"/auth/login",data:a}).then(function(a){localStorage.setItem("clusterpost_token",a.data.token)})},updatePassword:function(a,c){return b({method:"PUT",url:"/auth/login",data:a,headers:{authorization:"Bearer "+c}}).then(function(a){localStorage.setItem("clusterpost_token",a.data.token)})},sendRecoverPassword:function(a){return b({method:"POST",url:"/auth/reset",data:a})},logout:function(){localStorage.removeItem("clusterpost_token"),c.path("/")},updateUser:function(a){return b({method:"PUT",url:"/auth/users",data:a})},deleteUser:function(a){return b({method:"DELETE",url:"/auth/users",data:a})},getScopes:function(){return b({method:"GET",url:"/auth/scopes"})},updateScopes:function(a){return b({method:"PUT",url:"/auth/scopes",data:a})}}}]),angular.module("jwt-user-login").directive("userLogin",["$routeParams","$location","$rootScope","$timeout","clusterauth",function(a,b,c,d,e){function f(f,g,h){f.showLogin=!0,f.newUser={},f.user={},f.resetUser=!1,a.token&&(f.showLogin=!1,f.resetUser={token:a.token}),f.createUser=function(){e.createUser(f.newUser).then(function(){return e.getUser()}).then(function(a){c.user=a.data,b.path("/home")}).catch(function(a){409===a.status&&($("#inputEmailCreate").popover("show"),d(function(){$("#inputEmailCreate").popover("hide")},6e3))})},f.recoverPassword=function(a,b){a?e.sendRecoverPassword({email:a}).then(function(a){alert(a.data)}).catch(function(a){401===a.status&&(f.inputEmailPopup="You need to create an account first.",$("#"+b).popover("show"),d(function(){$("#"+b).popover("hide")},6e3))}):(f.inputEmailPopup="Please enter your email address",$("#"+b).popover("show"),d(function(){$("#"+b).popover("hide")},6e3))},f.resetPassword=function(){if(f.errorMsg="",f.resetUser.password0!==f.resetUser.password1)return alert("Passwords are not the same"),!1;e.updatePassword({password:f.resetUser.password1},f.resetUser.token).then(function(){return e.getUser()}).then(function(a){c.user=a.data,b.path("/home")}).catch(function(a){console.error(a)})},f.login=function(){f.errorMsg="",e.login(f.user).then(function(){return $("#loginbutton").popover("hide"),$("#inputEmail").popover("hide"),e.getUser()}).then(function(a){c.user=a.data,b.path("/home")}).catch(function(a){401===a.status&&f.user.password&&($("#loginbutton").popover("show"),d(function(){$("#loginbutton").popover("hide")},6e3))})},f.switchForm=function(){f.errorMsg="",f.showLogin=!f.showLogin}}return{restrict:"E",link:f,templateUrl:"./src/jwtUserLogin.template.html"}}]),angular.module("jwt-user-login").directive("users",["$routeParams","$location","$rootScope","dcbia","clusterauth",function(a,b,c,d,e){function f(a,b,c){e.getUsers().then(function(b){a.userdata=b.data}),e.getScopes().then(function(b){a.appScopes=b.data[0],a.userScopes=a.appScopes.scopes}).catch(function(a){console.error(a)}),a.newScope="",a.createScope=function(){""!=a.newScope&&(a.appScopes||(a.appScopes={type:"scopes",scopes:a.userScopes}),-1==a.appScopes.scopes.indexOf(a.newScope)&&(a.appScopes.scopes.push(a.newScope),a.newScope="",e.updateScopes(a.appScopes).then(function(a){return e.getScopes()}).then(function(b){a.appScopes=b.data[0],a.userScopes=a.appScopes.scopes})))},a.addRemoveScope=function(b,c){return a.hasScope(b,c)?b.scope.splice(b.scope.indexOf(c),1):b.scope.push(c),e.updateUser(b).then(function(c){_.each(a.userdata,function(a){a.email===b.email&&(a._rev=c.data.rev)})}).catch(alert)},a.deleteUser=function(b){confirm("Do you want to delete the user?")&&e.deleteUser(b).then(function(){for(var c=0;c<a.userdata.length;c++)a.userdata[c]._id===b._id&&a.userdata.splice(c,1)}).catch(console.error)},a.hasScope=function(a,b){return a.scope.indexOf(b)>=0}}return{restrict:"E",link:f,scope:{userScopes:"="},templateUrl:"./src/usersManager.template.html"}}]),angular.module("jwt-user-login").run(["$templateCache",function(a){"use strict";a.put("./src/jwtUserLogin.template.html",'<div class="ng-col-12 se-slope" >\n  <div style="text-align: center;width: 50%;margin-left: 25%;">\n    <div id="divlogin" ng-if="showLogin && !resetUser">\n      <form class="form-login">\n        <h2 class="form-login-heading">Please login</h2>\n        <label for="inputEmail" class="sr-only">Email address</label>\n        <input id="inputEmail" class="form-control" placeholder="Email address" required autofocus="" type="email" ng-model="user.email" data-container="#divlogin" data-toggle="popover" data-placement="right" data-content="Please enter your email address">\n        <label for="inputPassword" class="sr-only">Password</label>\n        <input id="inputPassword" class="form-control" placeholder="Password" required type="password" ng-model="user.password" pattern="(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 6 or more characters">\n        <button id="loginbutton" class="btn btn-lg btn-primary btn-block" type="submit" ng-click="login()" data-container="#divlogin" data-toggle="popover" data-placement="right" data-content="Check if email and password are correct!" data-template=\'<div class="popover alert-danger" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content alert-danger"></div></div>\'>Login</button>\n        <div class="etc-login-form">\n    \t\t\t<p>forgot your password? <a href="" ng-click="recoverPassword(user.email, \'inputEmail\')">click here</a></p>\n    \t\t\t<p>new user? <a href="" ng-click="switchForm()">create new account</a></p>\n    \t\t</div>\n      </form>\n    </div>\n\n    <div id="divCreate" ng-if="!showLogin && !resetUser">\n      <form class="form-create">\n        <h2 class="form-login-heading">Create an account</h2>\n        <label for="inputNameCreate" class="sr-only">User Name</label>\n        <input id="inputNameCreate" class="form-control" placeholder="User name" required="" autofocus="" type="text" ng-model="newUser.name">\n        <label for="inputEmailCreate" class="sr-only">Email address</label>\n        <input id="inputEmailCreate" class="form-control" placeholder="Email address" required="" autofocus="" type="email" ng-model="newUser.email"\n        data-container="#divCreate" data-toggle="popover" data-placement="right" data-content="You have an account with that email address already.">\n        <label for="inputPasswordCreate" class="sr-only" >Password</label> \n        <input id="inputPasswordCreate" class="form-control" placeholder="Password" required type="password" ng-model="newUser.password" pattern="(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Password must contain at least one number and one uppercase and lowercase letter, and at least 6 or more characters"> \n        <button class="btn btn-lg btn-primary btn-block" type="submit" ng-click="createUser()">Create and Login</button>\n        <div class="etc-login-form">\n          <p>existing user? <a href="" ng-click="switchForm()">Login with your account</a></p>\n        </div>\n      </form>\n    </div>\n\n    <div ng-if="resetUser">\n      <form class="form-rest-password" >\n        <h2 class="form-login-heading">Reset your password</h2>\n        <label for="inputPassword0" class="sr-only">Password</label>\n        <input id="inputPassword0" class="form-control" placeholder="Password" required="" type="password" ng-model="resetUser.password0" autocomplete="off">\n        <label for="inputPassword1" class="sr-only">Confirm Password</label>\n        <input id="inputPassword1" class="form-control" placeholder="Confirm assword" required="" type="password" ng-model="resetUser.password1" autocomplete="off">\n        <button class="btn btn-lg btn-primary btn-block" type="submit" ng-click="resetPassword()">Reset and Login</button>\n        <p> <a href="#/welcome">Login page</a> </p>\n      </form>\n    </div>\n  </div>\n</div>'),a.put("./src/usersManager.template.html",'<div class="row">\n\t<div class="col-md-2">\n\t\t<div class="panel panel-default">\n\t\t\t<div class="panel-heading">\n\t\t    \tManage scopes\n\t\t  \t</div>\n\t  \t\t<div class="panel-body">\n\t\t\t\t\t<div class="btn-group">\n\t\t\t\t\t<ul class="list-group">\n\t\t\t\t\t  \t<li ng-repeat="us in userScopes" class="list-group-item">{{us}}</li>\t\t\t\t \t\t\n\t\t\t\t\t  \t<li class="list-group-item">\n\t\t\t\t \t\t\t<input type="text" class="form-control" placeholder="Scope" aria-describedby="basic-addon1" ng-model="newScope">\n\t\t\t\t \t\t</li>\n\t\t\t\t\t  \t<button type="button" class="list-group-item list-group-item-action active" ng-click="createScope()">\n\t\t\t\t \t\t\t<span class="glyphicon glyphicon-plus"></span>\n\t\t\t\t \t\t\tNew Scope\n\t\t\t\t \t\t</button>\n\t\t\t\t \t</ul>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="col-md-10">\n\t\t<div class="panel panel-default">\n\t\t\t<div class="panel-heading">\n\t\t    \tManage user scopes\n\t\t  \t</div>\n\t\t\t<div class="panel-body">\n\t\t\t  \t<div class="panel panel-info" style="overflow:scroll">\n\t\t\t\t  \t<table st-table="displayedUsers" st-safe-src="userdata" class="table table-striped">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th >\n\t\t\t\t\t\t\t\t\t<input st-search="name" placeholder="search for username" class="input-sm form-control" type="search"/>\n\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t\t<th>\n\t\t\t\t\t\t\t\t\t<input st-search="email" placeholder="search for email" class="input-sm form-control" type="search"/>\n\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t\t<th colspan="{{userScopes.length}}">\n\t\t\t\t\t\t\t\t\t<input st-search="scope" placeholder="search for scope" class="input-sm form-control" type="search"/>\n\t\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr ng-repeat="user in displayedUsers">\n\t\t\t\t\t\t\t\t<td>{{user.name}}</td>\n\t\t\t\t\t\t\t\t<td>{{user.email}}</td>\n\t\t\t\t\t\t\t\t<td ng-repeat="us in userScopes">\n\t\t\t\t\t\t\t\t\t<div class="input-group">\n\t\t\t\t\t\t\t\t      <span class="input-group-addon">\n\t\t\t\t\t\t\t\t        <input type="checkbox" aria-label="..." ng-click="addRemoveScope(user, us)" ng-checked="hasScope(user, us)">\n\t\t\t\t\t\t\t\t      </span>\n\t\t\t\t\t\t\t\t      <label class="form-control" >{{ us }}</label>\n\t\t\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<button type="button" ng-click="deleteUser(user)" class="btn btn-sm btn-danger">\n\t\t\t\t\t\t\t\t\t<i class="glyphicon glyphicon-trash">\n\t\t\t\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>')}]);