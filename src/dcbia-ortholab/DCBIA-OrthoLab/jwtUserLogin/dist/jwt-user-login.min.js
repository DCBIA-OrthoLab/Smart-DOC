angular.module("jwt-user-login",["checklist-model"]);angular.module("jwt-user-login").config(["$httpProvider","$provide",function($httpProvider,$provide){$provide.factory("jwtInterceptor",["$q","$location",function($q,$location){return{request:function(config){var token=localStorage.getItem("clusterpost_token");if(token){config.headers.authorization="Bearer "+token}return config},requestError:function(rejection){return $q.reject(rejection)},response:function(response){return response},responseError:function(rejection){if(rejection.status===401&&!localStorage.getItem("clusterpost_token")&&$location.path()!=="/login"){$location.path("/")}if(rejection.status===404){console.error(rejection)}return $q.reject(rejection)}}}]);$httpProvider.interceptors.push("jwtInterceptor")}]).factory("clusterauth",["$q","$http","$location","$rootScope",function($q,$http,$location,$rootScope){return{createUser:function(user){return $http({method:"POST",url:"/auth/user",data:user}).then(function(res){localStorage.setItem("clusterpost_token",res.data.token)})},getUsers:function(){return $http({method:"GET",url:"/auth/users"})},getUser:function(){if($rootScope.user){return Promise.resolve($rootScope.user)}else{return $http({method:"GET",url:"/auth/user"}).then(function(res){$rootScope.user=res.data;return res.data})}},deleteSelf:function(){return $http({method:"DELETE",url:"/auth/user"})},login:function(user){return $http({method:"POST",url:"/auth/login",data:user}).then(function(res){localStorage.setItem("clusterpost_token",res.data.token)})},updatePassword:function(user,token){return $http({method:"PUT",url:"/auth/login",data:user,headers:{authorization:"Bearer "+token}}).then(function(res){localStorage.setItem("clusterpost_token",res.data.token)})},sendRecoverPassword:function(email){return $http({method:"POST",url:"/auth/reset",data:email})},logout:function(){localStorage.removeItem("clusterpost_token");$location.path("/")},updateUser:function(user){return $http({method:"PUT",url:"/auth/users",data:user})},deleteUser:function(user){return $http({method:"DELETE",url:"/auth/users",data:user})},getScopes:function(){return $http({method:"GET",url:"/auth/scopes"})},updateScopes:function(scopes){return $http({method:"PUT",url:"/auth/scopes",data:scopes})}}}]);angular.module("jwt-user-login").directive("userLogin",["$routeParams","$location","$rootScope","$timeout","clusterauth",function($routeParams,$location,$rootScope,$timeout,clusterauth){function link($scope,$attrs,$filter){$scope.showLogin=true;$scope.newUser={};$scope.user={};$scope.resetUser=false;if($routeParams.token){$scope.showLogin=false;$scope.resetUser={token:$routeParams.token}}$scope.createUser=function(){clusterauth.createUser($scope.newUser).then(function(){return clusterauth.getUser()}).then(function(res){$rootScope.user=res.data;$location.path("/home")}).catch(function(e){if(e.status===409){$("#inputEmailCreate").popover("show");$timeout(function(){$("#inputEmailCreate").popover("hide")},6e3)}})};$scope.recoverPassword=function(email,popup){if(!email){$scope.inputEmailPopup="Please enter your email address";$("#"+popup).popover("show");$timeout(function(){$("#"+popup).popover("hide")},6e3)}else{clusterauth.sendRecoverPassword({email:email}).then(function(res){alert(res.data)}).catch(function(e){if(e.status===401){$scope.inputEmailPopup="You need to create an account first.";$("#"+popup).popover("show");$timeout(function(){$("#"+popup).popover("hide")},6e3)}})}};$scope.resetPassword=function(){$scope.errorMsg="";if($scope.resetUser.password0===$scope.resetUser.password1){clusterauth.updatePassword({password:$scope.resetUser.password1},$scope.resetUser.token).then(function(){return clusterauth.getUser()}).then(function(res){$rootScope.user=res.data;$location.path("/home")}).catch(function(e){console.error(e)})}else{alert("Passwords are not the same");return false}};$scope.login=function(){$scope.errorMsg="";clusterauth.login($scope.user).then(function(){$("#loginbutton").popover("hide");$("#inputEmail").popover("hide");return clusterauth.getUser()}).then(function(res){$rootScope.user=res.data;$location.path("/home")}).catch(function(e){if(e.status===401&&$scope.user.password){$("#loginbutton").popover("show");$timeout(function(){$("#loginbutton").popover("hide")},6e3)}})};$scope.switchForm=function(){$scope.errorMsg="";$scope.showLogin=!$scope.showLogin}}return{restrict:"E",link:link,templateUrl:"./src/jwtUserLogin.template.html"}}]);angular.module("jwt-user-login").directive("users",["$routeParams","$location","$rootScope","clusterauth",function($routeParams,$location,$rootScope,clusterauth){function link($scope,$attrs,$filter){clusterauth.getUsers().then(function(res){$scope.userdata=res.data});clusterauth.getScopes().then(function(res){$scope.appScopes=res.data[0];$scope.userScopes=$scope.appScopes.scopes}).catch(function(e){console.error(e)});$scope.newScope="";$scope.createScope=function(){if($scope.newScope!=""){if(!$scope.appScopes){$scope.appScopes={type:"scopes",scopes:$scope.userScopes}}if($scope.appScopes.scopes.indexOf($scope.newScope)==-1){$scope.appScopes.scopes.push($scope.newScope);$scope.newScope="";clusterauth.updateScopes($scope.appScopes).then(function(res){return clusterauth.getScopes()}).then(function(res){$scope.appScopes=res.data[0];$scope.userScopes=$scope.appScopes.scopes})}}};$scope.addRemoveScope=function(user,scope){if($scope.hasScope(user,scope)){user.scope.splice(user.scope.indexOf(scope),1)}else{user.scope.push(scope)}return clusterauth.updateUser(user).then(function(res){_.each($scope.userdata,function(us){if(us.email===user.email){us._rev=res.data.rev}})}).catch(alert)};$scope.deleteUser=function(user){if(confirm("Do you want to delete the user?")){clusterauth.deleteUser(user).then(function(){for(var i=0;i<$scope.userdata.length;i++){if($scope.userdata[i]._id===user._id){$scope.userdata.splice(i,1)}}}).catch(console.error)}};$scope.hasScope=function(user,scope){return user.scope.indexOf(scope)>=0}}return{restrict:"E",link:link,scope:{userScopes:"="},templateUrl:"./src/usersManager.template.html"}}]);angular.module("jwt-user-login").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("./src/jwtUserLogin.template.html",'<div class="ng-col-12 se-slope" >\n'+'  <div style="text-align: center;width: 50%;margin-left: 25%;">\n'+'    <div id="divlogin" ng-if="showLogin && !resetUser">\n'+'      <form class="form-login">\n'+'        <h2 class="form-login-heading">Please login</h2>\n'+'        <label for="inputEmail" class="sr-only">Email address</label>\n'+'        <input id="inputEmail" class="form-control" placeholder="Email address" required autofocus="" type="email" ng-model="user.email" data-container="#divlogin" data-toggle="popover" data-placement="right" data-content="Please enter your email address">\n'+'        <label for="inputPassword" class="sr-only">Password</label>\n'+'        <input id="inputPassword" class="form-control" placeholder="Password" required type="password" ng-model="user.password" pattern="(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 6 or more characters">\n'+'        <button id="loginbutton" class="btn btn-lg btn-primary btn-block" type="submit" ng-click="login()" data-container="#divlogin" data-toggle="popover" data-placement="right" data-content="Check if email and password are correct!" data-template=\'<div class="popover alert-danger" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content alert-danger"></div></div>\'>Login</button>\n'+'        <div class="etc-login-form">\n'+'    \t\t\t<p>forgot your password? <a href="" ng-click="recoverPassword(user.email, \'inputEmail\')">click here</a></p>\n'+'    \t\t\t<p>new user? <a href="" ng-click="switchForm()">create new account</a></p>\n'+"    \t\t</div>\n"+"      </form>\n"+"    </div>\n"+"\n"+'    <div id="divCreate" ng-if="!showLogin && !resetUser">\n'+'      <form class="form-create">\n'+'        <h2 class="form-login-heading">Create an account</h2>\n'+'        <label for="inputNameCreate" class="sr-only">User Name</label>\n'+'        <input id="inputNameCreate" class="form-control" placeholder="User name" required="" autofocus="" type="text" ng-model="newUser.name">\n'+'        <label for="inputEmailCreate" class="sr-only">Email address</label>\n'+'        <input id="inputEmailCreate" class="form-control" placeholder="Email address" required="" autofocus="" type="email" ng-model="newUser.email"\n'+'        data-container="#divCreate" data-toggle="popover" data-placement="right" data-content="You have an account with that email address already.">\n'+'        <label for="inputPasswordCreate" class="sr-only" >Password</label> \n'+'        <input id="inputPasswordCreate" class="form-control" placeholder="Password" required type="password" ng-model="newUser.password" pattern="(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Password must contain at least one number and one uppercase and lowercase letter, and at least 6 or more characters"> \n'+'        <button class="btn btn-lg btn-primary btn-block" type="submit" ng-click="createUser()">Create and Login</button>\n'+'        <div class="etc-login-form">\n'+'          <p>existing user? <a href="" ng-click="switchForm()">Login with your account</a></p>\n'+"        </div>\n"+"      </form>\n"+"    </div>\n"+"\n"+'    <div ng-if="resetUser">\n'+'      <form class="form-rest-password" >\n'+'        <h2 class="form-login-heading">Reset your password</h2>\n'+'        <label for="inputPassword0" class="sr-only">Password</label>\n'+'        <input id="inputPassword0" class="form-control" placeholder="Password" required="" type="password" ng-model="resetUser.password0" autocomplete="off">\n'+'        <label for="inputPassword1" class="sr-only">Confirm Password</label>\n'+'        <input id="inputPassword1" class="form-control" placeholder="Confirm assword" required="" type="password" ng-model="resetUser.password1" autocomplete="off">\n'+'        <button class="btn btn-lg btn-primary btn-block" type="submit" ng-click="resetPassword()">Reset and Login</button>\n'+'        <p> <a href="#/welcome">Login page</a> </p>\n'+"      </form>\n"+"    </div>\n"+"  </div>\n"+"</div>");$templateCache.put("./src/usersManager.template.html",'<div class="row">\n'+'\t<div class="col-md-2">\n'+'\t\t<div class="panel panel-default">\n'+'\t\t\t<div class="panel-heading">\n'+"\t\t    \tManage scopes\n"+"\t\t  \t</div>\n"+'\t  \t\t<div class="panel-body">\n'+'\t\t\t\t\t<div class="btn-group">\n'+'\t\t\t\t\t<ul class="list-group">\n'+'\t\t\t\t\t  \t<li ng-repeat="us in userScopes" class="list-group-item">{{us}}</li>\t\t\t\t \t\t\n'+'\t\t\t\t\t  \t<li class="list-group-item">\n'+'\t\t\t\t \t\t\t<input type="text" class="form-control" placeholder="Scope" aria-describedby="basic-addon1" ng-model="newScope">\n'+"\t\t\t\t \t\t</li>\n"+'\t\t\t\t\t  \t<button type="button" class="list-group-item list-group-item-action active" ng-click="createScope()">\n'+'\t\t\t\t \t\t\t<span class="glyphicon glyphicon-plus"></span>\n'+"\t\t\t\t \t\t\tNew Scope\n"+"\t\t\t\t \t\t</button>\n"+"\t\t\t\t \t</ul>\n"+"\t\t\t\t</div>\n"+"\t\t\t</div>\n"+"\t\t</div>\n"+"\t</div>\n"+'\t<div class="col-md-10">\n'+'\t\t<div class="panel panel-default">\n'+'\t\t\t<div class="panel-heading">\n'+"\t\t    \tManage user scopes\n"+"\t\t  \t</div>\n"+'\t\t\t<div class="panel-body">\n'+'\t\t\t  \t<div class="panel panel-info" style="overflow:scroll">\n'+'\t\t\t\t  \t<table st-table="displayedUsers" st-safe-src="userdata" class="table table-striped">\n'+"\t\t\t\t\t\t<thead>\n"+"\t\t\t\t\t\t\t<tr>\n"+"\t\t\t\t\t\t\t\t<th >\n"+'\t\t\t\t\t\t\t\t\t<input st-search="name" placeholder="search for username" class="input-sm form-control" type="search"/>\n'+"\t\t\t\t\t\t\t\t</th>\n"+"\t\t\t\t\t\t\t\t<th>\n"+'\t\t\t\t\t\t\t\t\t<input st-search="email" placeholder="search for email" class="input-sm form-control" type="search"/>\n'+"\t\t\t\t\t\t\t\t</th>\n"+'\t\t\t\t\t\t\t\t<th colspan="{{userScopes.length}}">\n'+'\t\t\t\t\t\t\t\t\t<input st-search="scope" placeholder="search for scope" class="input-sm form-control" type="search"/>\n'+"\t\t\t\t\t\t\t\t</th>\n"+"\t\t\t\t\t\t\t</tr>\n"+"\t\t\t\t\t\t</thead>\n"+"\t\t\t\t\t\t<tbody>\n"+'\t\t\t\t\t\t\t<tr ng-repeat="user in displayedUsers">\n'+"\t\t\t\t\t\t\t\t<td>{{user.name}}</td>\n"+"\t\t\t\t\t\t\t\t<td>{{user.email}}</td>\n"+'\t\t\t\t\t\t\t\t<td ng-repeat="us in userScopes">\n'+'\t\t\t\t\t\t\t\t\t<div class="input-group">\n'+'\t\t\t\t\t\t\t\t      <span class="input-group-addon">\n'+'\t\t\t\t\t\t\t\t        <input type="checkbox" aria-label="..." ng-click="addRemoveScope(user, us)" ng-checked="hasScope(user, us)">\n'+"\t\t\t\t\t\t\t\t      </span>\n"+'\t\t\t\t\t\t\t\t      <label class="form-control" >{{ us }}</label>\n'+"\t\t\t\t\t\t\t\t    </div>\n"+"\t\t\t\t\t\t\t\t</td>\n"+"\t\t\t\t\t\t\t\t<td>\n"+'\t\t\t\t\t\t\t\t\t<button type="button" ng-click="deleteUser(user)" class="btn btn-sm btn-danger">\n'+'\t\t\t\t\t\t\t\t\t<i class="glyphicon glyphicon-trash">\n'+"\t\t\t\t\t\t\t\t\t\t</i>\n"+"\t\t\t\t\t\t\t\t\t</button>\n"+"\t\t\t\t\t\t\t\t</td>\n"+"\t\t\t\t\t\t\t</tr>\n"+"\t\t\t\t\t\t</tbody>\n"+"\t\t\t\t\t</table>\n"+"\t\t\t\t</div>\n"+"\t\t\t</div>\n"+"\t\t</div>\n"+"\t</div>\n"+"</div>")}]);
//# sourceMappingURL=jwt-user-login.min.js.map